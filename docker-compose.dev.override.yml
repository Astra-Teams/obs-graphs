services:
  ollama:
    build:
      context: ./ollama
      dockerfile: Dockerfile
      args:
        BUILT_IN_OLLAMA_MODELS: ${CONTAINER_OLLAMA_MODEL}
    volumes:
      - ollama:/root/.ollama
    networks:
      - backend

  db:
    environment:
      - POSTGRES_DB=${POSTGRES_DEV_DB}

  api:
    build:
      target: development
    ports: !override
      - "${HOST_BIND_IP}:${DEV_PORT}:8000"
    environment:
      - POSTGRES_DB=${POSTGRES_DEV_DB}
    volumes:
      - .:/app
      - /app/.venv

  celery-worker:
    build:
      target: development
    command: celery -A src.tasks.celery_app worker --loglevel=info
    environment:
      - POSTGRES_DB=${POSTGRES_DEV_DB}
    volumes:
      - .:/app
      - /app/.venv

volumes:
  ollama:
    driver: local
    name: ${PROJECT_NAME}-ollama
    external: false
